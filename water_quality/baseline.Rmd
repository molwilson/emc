---
title: "Water quality"
author: "Molly Wilson"
date: "5/17/2021"
output: html_document
---

```{r, message = F, warning = F, echo = F}
# setup

library(tidyverse)
library(here) # for accessing files with directory
library(readxl) # for reading indv. sheets within excel files
library(janitor) # for cleaning variable names so they have consistent capitalization etc.
library(knitr) # for including tables
library(ggpubr) # for printing multiple plots together

knitr::opts_chunk$set(message = FALSE, warning = FALSE) # this sets the preferences for each code chunk so that errors/messages/warnings don't get displayed in the knit rmarkdown
```

```{r}
samples <- read_excel(here("water_quality", "samples.xlsx"), sheet = "raw_data") %>% clean_names() %>%
  select(-nitrate_raw) %>%
  unite(id_site, id, site, sep = " ", remove = F) %>%
  mutate(temp_min = 23.3,
         temp_max = 29.6)
control <- filter(samples, type == "control")
```

```{r}
c_range <- "slategray1"
c_control <- "slategray"

# pH: 7.7 and 8.5 units  (EPMA, 2019)
ph <- ggplot(filter(samples, type == "sample"), aes(x = site, y = ph)) +
  annotate("rect", xmin=-Inf, xmax=Inf, ymin=7.7, ymax=8.5, alpha=0.4, fill = c_range) +
  geom_hline(yintercept = control$ph, linetype = "dashed", color = c_control) +
  geom_point(color = "black") +
  labs(x = "", y = "pH") +
  ylim(5, 9) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# TDS: ?
tds <- ggplot(filter(samples, type == "sample"), aes(x = site, y = tds)) +
  geom_hline(yintercept = control$tds, linetype = "dashed", color = c_control) +
  geom_point(color = "black") +
  labs(x = "", y = "TDS (ppm)") +
  ylim(30000, 40000) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Salinity: 32,000 to 42,000 ppm (NOAA)
salinity <- ggplot(filter(samples, type == "sample"), aes(x = site, y = salinity)) +
  annotate("rect", xmin=-Inf, xmax=Inf, ymin=32000, ymax=42000, alpha=0.4, fill = c_range) +
  geom_hline(yintercept = control$salinity, linetype = "dashed", color = c_control) +
  geom_point(color = "black") +
  labs(x = "", y = "Salinity (ppm)") +
  ylim(25000, 50000) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Turbidity: <1.5 NTU?
turbidity <- ggplot(filter(samples, type == "sample"), aes(x = site, y = turbidity)) +
  annotate("rect", xmin=-Inf, xmax=Inf, ymin=0, ymax=1.5, alpha=0.4, fill = c_range) +
  geom_hline(yintercept = control$turbidity, linetype = "dashed", color = c_control) +
  geom_point(color = "black") +
  labs(x = "", y = "Turbidity (NTU)") +
  ylim(0, 3) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# DO: Must be greater than 6.0 ppm  (EPMA, 2019)
do <- ggplot(filter(samples, type == "sample"), aes(x = site, y = do)) +
  annotate("rect", xmin=-Inf, xmax=Inf, ymin=6, ymax=8, alpha=0.4, fill = c_range) +
  geom_hline(yintercept = control$do, linetype = "dashed", color = c_control) +
  geom_point(color = "black") +
  labs(x = "", y = "Dissolved oxygen (ppm)") +
  ylim(0, 8) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Nitrates: ?
nitrate <- ggplot(filter(samples, type == "sample"), aes(x = site, y = nitrate)) +
  geom_hline(yintercept = control$nitrate, linetype = "dashed", color = c_control) +
  geom_point(color = "black") +
  labs(x = "", y = "Nitrate (ppm)") +
  ylim(0, 0.2) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

#Phosphates: ?
phosphate <- ggplot(filter(samples, type == "sample"), aes(x = site, y = phosphate)) +
  geom_hline(yintercept = control$phosphate, linetype = "dashed", color = c_control) +
  geom_point(color = "black") +
  labs(x = "", y = "Phosphate (ppm)") +
  ylim(0, 0.6) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

# Temperature: 23°–29.6°Celsius (NOAA)
temp <- ggplot(filter(samples, type == "sample"), aes(x = site, y = temperature)) +
  annotate("rect", xmin=-Inf, xmax=Inf, ymin=23, ymax=29.6, alpha=0.4, fill = c_range) +
  geom_hline(yintercept = control$temperature, linetype = "dashed", color = c_control) +
  geom_point(color = "black") +
  labs(x = "", y = expression("Temperature ("*~degree*C*")")) +
  ylim(18, 32) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```


```{r, fig.width = 4, fig.height = 8}
ggarrange(ph, do, tds, turbidity, nitrate, phosphate, salinity, temp, 
          ncol = 2, nrow = 4)
ggsave(here("water_quality", "figs", "samples_4.15.21.png"))
```


