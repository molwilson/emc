---
title: "Nursery map"
author: "Molly Wilson"
date: "2023-02-25"
output: html_document
---

```{r, message = F, warning = F, echo = F}
library(tidyverse)
library(here) # for accessing files with directory
library(readxl) # for reading indv. sheets within excel files

knitr::opts_chunk$set(message = FALSE, warning = FALSE) # this sets the preferences for each code chunk so that errors/messages/warnings don't get displayed in the knit rmarkdown
```

```{r}
letter_names <- function(nms) LETTERS[seq_along(nms)]
york <- read_excel(here("nursery_monitoring", "data", "nursery map.xlsx"), 
                  sheet = "York_Feb 2023", 
                  col_names = FALSE, 
                  .name_repair = letter_names)
tpb <- read_excel(here("nursery_monitoring", "data", "nursery map.xlsx"), 
                  sheet = "TPB_Feb 2023", 
                  n_max = 10,
                  col_names = FALSE, 
                  .name_repair = letter_names)


locations <- york %>% mutate(row=row_number()) %>%
  pivot_longer(
    cols = -row,
    names_to = "col",
    values_to = "genotype",
    values_drop_na = TRUE
  ) %>%
  mutate(nursery = "York",
         structure = case_when(str_detect(genotype, "GB") ~ "Tree",
                               row <= 5 ~ "Rope",
                               row > 5 ~ "Tree")
           ) %>%
  rbind(tpb %>% mutate(row=row_number()) %>%
          pivot_longer(
          cols = -row,
          names_to = "col",
          values_to = "genotype",
          values_drop_na = TRUE
      ) %>%
  mutate(nursery = "Ten Pound",
         structure = case_when(row <= 2 ~ "Tree",
                               row > 2 ~ "Rope")
           )) %>%
  unite(location, col, row, sep = "", remove = TRUE) %>%
  mutate(genotype = strsplit(as.character(genotype), " / ")) %>% 
  unnest(genotype) %>%
  select(genotype, nursery, location, structure)
  
write.csv(locations, here("nursery_monitoring", "data", "genotype_locations.csv"))
```