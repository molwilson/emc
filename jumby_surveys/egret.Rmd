---
title: "Egret data"
author: "Molly Wilson"
date: "9/12/2021"
output: html_document
---


```{r, message = F, warning = F, echo = F}
# setup

library(tidyverse)
library(here) # for accessing files with directory
library(readxl) # for reading indv. sheets within excel files
library(janitor) # for cleaning variable names so they have consistent capitalization etc.
library(knitr) # for including tables
library(ggpubr) # for printing multiple plots together

knitr::opts_chunk$set(message = FALSE, warning = FALSE) # this sets the preferences for each code chunk so that errors/messages/warnings don't get displayed in the knit rmarkdown
```

```{r}
quadrants <- read_excel(here("jumby_surveys", "Egret_surveys.xlsx"), sheet = "quadrants") %>%  
  clean_names()

test <- quadrants %>%
  group_by(surveyor, transect, quadrant) %>%
  summarise(total = sum(percent))
```

Percent cover
```{r}
quad_exp <- quadrants %>%
  expand(transect, quadrant, species) %>%
  left_join(quadrants %>% select(transect, quadrant, species, percent)) %>%
  mutate(percent = replace_na(percent, 0)) %>%
  left_join(quadrants %>% select(species, code, category), by ="species") %>%
  distinct()

cover_spp <- quad_exp %>%
  group_by(transect, category, species) %>%
  summarise(percent_tran = mean(percent),
            se = sd(percent)/sqrt(10)) %>%
  group_by(category, species) %>%
  summarise(percent_tot = mean(percent_tran),
            se = sd(percent_tran)/sqrt(12)) %>%
  arrange(category, -percent_tot) %>%
  mutate(species = factor(species, levels = species))

ggplot(cover_spp, aes(x = species, y = percent_tot, group = category)) +
  geom_col(aes(fill = category)) +
  labs(x = "", y = "Mean percent cover", fill = "Category") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggsave(here("jumby_surveys", "figs", "spp_col.png"), width = 6, height = 6)

cover_cat <- quad_exp %>%
  group_by(transect, quadrant, category) %>%
  summarize(percent_cat = sum(percent)) %>%
  group_by(transect, category) %>%
  summarize(percent_tran = mean(percent_cat),
            se = sd(percent_cat)/sqrt(10)) %>%
  group_by(category) %>%
  summarize(percent_tot = mean(percent_tran),
            se = sd(percent_tran)/sqrt(12))
  
ggplot(cover_cat, aes(x = reorder(category, -percent_tot), y = percent_tot)) +
  geom_col() +
  theme_bw() +
  labs(x = "Category", y = "Mean percent cover")


  
```

